<!-- --- START OF FILE pending_application.html --- -->

{% extends 'base.html' %}

{% block title %}Application Status{% endblock %}

{% block head %}
{{ super() }}
<link rel="icon" href="{{ url_for('static', filename='logopgpc.png') }}" type="image/x-icon">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Pacifico&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.min.css" rel="stylesheet">
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<script>
tailwind.config = {
    theme: {
        extend: {
            colors: {
                primary: '#1e40af', // Reverted to Blue
                secondary: '#3b82f6',
                pgpc_blue: '#1e40af'
            },
            borderRadius: {
                DEFAULT: '8px',
                'xl': '12px',
                '2xl': '16px'
            }
        }
    }
}
</script>
<style>
    :where([class^="ri-"])::before { content: "\f3c2"; }
    @media print {
        body, html { background-color: white !important; margin: 0 !important; padding: 0 !important; }
        aside, header, .no-print, #sidebar, #sidebar-overlay { display: none !important; }
        .main-content-wrapper { margin: 0 !important; padding: 0 !important; }
        #printable-content, #printable-content-passed { margin: 0; padding: 0; }
        .permit-stub-value { border: 1px solid #000 !important; color: #000 !important; }
    }
    .sidebar-scroll::-webkit-scrollbar { width: 4px; }
    .sidebar-scroll::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 4px; }
</style>
{% endblock %}

{% block body %}
<div class="flex h-screen bg-gray-50 overflow-hidden">
    
    <!-- Mobile Sidebar Overlay -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-40 hidden lg:hidden"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="w-64 bg-white border-r border-gray-200 flex-shrink-0 fixed lg:static inset-y-0 left-0 z-50 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 sidebar-scroll overflow-y-auto flex flex-col">
        <div class="h-16 flex items-center px-6 border-b border-gray-200">
            <a href="{{ url_for('views.home') }}" class="flex items-center gap-2">
                <img src="{{ url_for('static', filename='logopgpc.png') }}" alt="Logo" class="w-8 h-8 object-contain">
                <span class="text-blue-900 font-['Georgia'] text-lg">PGPC Dashboard</span>
            </a>
        </div>
        <nav class="flex-1 p-4 space-y-1">
            <a href="{{ url_for('views.application_status_page') }}" class="flex items-center space-x-3 px-4 py-3 text-sm font-medium rounded-lg transition-colors bg-blue-50 text-blue-700">
                <i class="ri-dashboard-line text-lg"></i><span>Dashboard</span>
            </a>
            <a href="{{ url_for('views.view_student_statement') }}" class="flex items-center space-x-3 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-gray-600 hover:bg-gray-50 hover:text-gray-900">
                <i class="ri-wallet-3-line text-lg"></i><span>Statement of Account</span>
            </a>
            <a href="{{ url_for('auth.view_student_grades') }}" class="flex items-center space-x-3 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-gray-600 hover:bg-gray-50 hover:text-gray-900">
                <i class="ri-book-read-line text-lg"></i><span>My Grades</span>
            </a>
            <a href="{{ url_for('views.student_resources') }}" class="flex items-center space-x-3 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-gray-600 hover:bg-gray-50 hover:text-gray-900">
                <i class="ri-download-cloud-2-line text-lg"></i><span>Downloads</span>
            </a>
            <a href="{{ url_for('auth.student_messenger') }}" class="flex items-center space-x-3 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-gray-600 hover:bg-gray-50 hover:text-gray-900">
                <i class="ri-messenger-line text-lg"></i><span>Messenger</span>
            </a>
             <a href="{{ url_for('auth.change_password_page') }}" class="flex items-center space-x-3 px-4 py-3 text-sm font-medium rounded-lg transition-colors text-gray-600 hover:bg-gray-50 hover:text-gray-900">
                <i class="ri-lock-password-line text-lg"></i><span>Change Password</span>
            </a>
        </nav>
        <div class="p-4 border-t border-gray-200">
            <a href="{{ url_for('auth.logout') }}" class="flex items-center justify-center space-x-2 px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 rounded-lg transition-colors border border-red-200 w-full">
                <i class="ri-logout-box-line"></i><span>Sign Out</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col min-w-0 main-content-wrapper">
        
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 px-6 py-3 flex items-center justify-between shadow-sm z-10 sticky top-0">
            <div class="flex items-center gap-4">
                <button id="sidebar-toggle" class="lg:hidden text-gray-500 hover:text-blue-600">
                    <i class="ri-menu-2-line text-2xl"></i>
                </button>
                <h2 class="text-lg font-bold text-gray-800 hidden sm:block">Dashboard</h2>
            </div>
            
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-3 pl-4 border-l border-gray-200">
                    <div class="text-right hidden sm:block">
                        <div class="text-sm font-bold text-gray-800">{{ application.first_name }} {{ application.last_name }}</div>
                        <div class="text-xs text-gray-500">{{ application.program_choice }}</div>
                    </div>
                    <img src="{{ url_for('auth.get_applicant_photo', applicant_id=application.applicant_id) }}?t={{ application.last_updated_at.timestamp() if application.last_updated_at else '' }}"
                         onerror="this.src='{{ url_for('static', filename='images/default_avatar.png') }}'"
                         alt="Avatar" class="w-9 h-9 rounded-full object-cover border border-gray-300">
                </div>
            </div>
        </header>

        <!-- Content Area -->
        <main class="flex-1 overflow-y-auto p-4 md:p-8 bg-gray-50">
            <div class="max-w-7xl mx-auto">
                
                {% if application %}
                {% set status = application.application_status %}

                <!-- Welcome Banner -->
                <div class="bg-white rounded-xl p-6 mb-8 border border-gray-200 shadow-sm flex flex-col md:flex-row items-center justify-between gap-4">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">Welcome, {{ application.first_name }}!</h1>
                        <p class="text-gray-600 mt-1">Academic Year: <span class="font-semibold text-blue-600">{{ active_term.year_name if active_term else '2025-2026' }}</span></p>
                    </div>
                    <div class="text-right hidden md:block">
                        <p class="text-xs text-gray-400 uppercase font-bold">Student ID</p>
                        <p class="text-lg font-mono font-bold text-gray-800">
                            {% if application.old_student_id %}{{ application.old_student_id }}
                            {% elif application.control_number %}{{ application.control_number }}
                            {% else %}P{{ application.academic_year[:4] if application.academic_year else '2025' }}{{ "%04d" | format(application.applicant_id) }}
                            {% endif %}
                        </p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left Column -->
                    <div class="lg:col-span-2 space-y-6">
                        
                        <!-- Progress -->
                        {% set hide_tracker = status in ['Rejected', 'Failed', 'Enrolling', 'Enrolled', 'Dropped', 'Not Enrolled', 'Eligible for Enrollment'] %}
                        {% if not hide_tracker %}
                            {% set current_step = 1 %}
                            {% if status == 'Approved' %}{% set current_step = 2 %}{% endif %}
                            {% if status == 'Scheduled' %}{% set current_step = 3 %}{% endif %}
                            {% if status == 'Passed' %}{% set current_step = 4 %}{% endif %}
                            
                            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                                <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-6">Application Progress</h3>
                                <div class="relative px-4">
                                    <div class="absolute top-1/2 left-0 w-full h-1 bg-gray-100 -translate-y-1/2 rounded -z-10"></div>
                                    <div class="absolute top-1/2 left-0 h-1 bg-blue-600 -translate-y-1/2 rounded -z-10 transition-all duration-500" style="width: {{ ((current_step - 1) / 3 * 100) }}%;"></div>
                                    <div class="flex justify-between w-full">
                                        {% for step in range(1, 5) %}
                                        <div class="flex flex-col items-center bg-white px-2">
                                            <div class="w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm border-2 transition-all duration-300 {{ 'bg-blue-600 border-blue-600 text-white' if current_step >= step else 'bg-white border-gray-300 text-gray-400' }}">
                                                {% if current_step > step %}<i class="ri-check-line"></i>{% else %}{{ step }}{% endif %}
                                            </div>
                                            <span class="mt-2 text-[10px] uppercase font-bold {{ 'text-blue-700' if current_step >= step else 'text-gray-400' }}">
                                                {% if step == 1 %}Submitted{% elif step == 2 %}Approved{% elif step == 3 %}Exam{% else %}Passed{% endif %}
                                            </span>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}

                        <!-- Main Status Card -->
                        {% set status_config = {
                            'Pending': {'color': 'yellow', 'icon': 'ri-time-line', 'title': 'Pending Review', 'bg': 'bg-yellow-50', 'text': 'text-yellow-700', 'border': 'border-yellow-200'},
                            'In Review': {'color': 'blue', 'icon': 'ri-file-search-line', 'title': 'In Review', 'bg': 'bg-blue-50', 'text': 'text-blue-700', 'border': 'border-blue-200'},
                            'Approved': {'color': 'emerald', 'icon': 'ri-checkbox-circle-line', 'title': 'Approved', 'bg': 'bg-emerald-50', 'text': 'text-emerald-700', 'border': 'border-emerald-200'},
                            'Scheduled': {'color': 'indigo', 'icon': 'ri-calendar-check-line', 'title': 'Exam Scheduled', 'bg': 'bg-indigo-50', 'text': 'text-indigo-700', 'border': 'border-indigo-200'},
                            'Rejected': {'color': 'red', 'icon': 'ri-close-circle-line', 'title': 'Rejected', 'bg': 'bg-red-50', 'text': 'text-red-700', 'border': 'border-red-200'},
                            'Passed': {'color': 'teal', 'icon': 'ri-shield-check-line', 'title': 'Passed', 'bg': 'bg-teal-50', 'text': 'text-teal-700', 'border': 'border-teal-200'},
                            'Failed': {'color': 'orange', 'icon': 'ri-shield-cross-line', 'title': 'Failed', 'bg': 'bg-orange-50', 'text': 'text-orange-700', 'border': 'border-orange-200'},
                            'Eligible for Enrollment': {'color': 'purple', 'icon': 'ri-calendar-event-line', 'title': 'Eligible for Enrollment', 'bg': 'bg-purple-50', 'text': 'text-purple-700', 'border': 'border-purple-200'},
                            'Enrolling': {'color': 'blue', 'icon': 'ri-loader-4-line', 'title': 'Enrollment in Progress', 'bg': 'bg-blue-50', 'text': 'text-blue-700', 'border': 'border-blue-200'},
                            'Enrolled': {'color': 'green', 'icon': 'ri-school-line', 'title': 'Enrolled', 'bg': 'bg-green-50', 'text': 'text-green-700', 'border': 'border-green-200'},
                            'Dropped': {'color': 'gray', 'icon': 'ri-user-unfollow-line', 'title': 'Dropped', 'bg': 'bg-gray-100', 'text': 'text-gray-700', 'border': 'border-gray-300'},
                            'Not Enrolled': {'color': 'red', 'icon': 'ri-error-warning-line', 'title': 'Not Enrolled', 'bg': 'bg-red-50', 'text': 'text-red-700', 'border': 'border-red-200'},
                        } %}
                        {% set current = status_config.get(status, {'color': 'gray', 'icon': 'ri-question-mark', 'title': status, 'bg': 'bg-gray-50', 'text': 'text-gray-700', 'border': 'border-gray-200'}) %}

                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                            <div class="p-6 border-b border-gray-100 flex items-center gap-4">
                                <div class="w-12 h-12 {{ current.bg }} {{ current.text }} rounded-full flex items-center justify-center text-2xl">
                                    <i class="{{ current.icon }}"></i>
                                </div>
                                <div>
                                    <h2 class="text-xl font-bold text-gray-900">{{ current.title }}</h2>
                                    <p class="text-sm text-gray-500">Last Updated: {{ application.last_updated_at.strftime('%B %d, %Y') if application.last_updated_at else 'N/A' }}</p>
                                </div>
                            </div>
                            
                            <div class="p-6">
                                <div class="bg-gray-50 rounded-lg p-4 text-sm text-gray-700 border border-gray-200 leading-relaxed mb-6">
                                    <p class="font-bold text-gray-900 mb-2">Message:</p>
                                    {% if status == 'Pending' %}{{ global_content.status_msg_pending | safe }}
                                    {% elif status == 'In Review' %}{{ global_content.status_msg_review | safe }}
                                    {% elif status == 'Approved' %}{{ global_content.status_msg_approved | safe }}
                                    {% elif status == 'Scheduled' %}{{ global_content.status_msg_scheduled | safe }}
                                    {% elif status == 'Rejected' %}{{ global_content.status_msg_rejected | safe }}
                                    {% elif status == 'Passed' %}{{ global_content.status_msg_passed | safe }}
                                    {% elif status == 'Failed' %}{{ global_content.status_msg_failed | safe }}
                                    {% elif status == 'Enrolling' %}{{ global_content.status_msg_enrolling | safe }}
                                    {% elif status == 'Enrolled' %}{{ global_content.status_msg_enrolled | safe }}
                                    {% elif status == 'Dropped' %}{{ global_content.status_msg_dropped | safe }}
                                    {% elif status == 'Not Enrolled' %}{{ global_content.status_msg_not_enrolled | safe }}
                                    {% elif status == 'Eligible for Enrollment' %}{{ global_content.status_msg_enrolling | safe }}
                                    {% else %}Please check your email or contact the registrar.{% endif %}
                                </div>

                                <!-- Requirements -->
                                {% set req_key = 'status_msg_' ~ status.lower().replace(' ', '_') %}
                                {% if status == 'Eligible for Enrollment' %}{% set req_key = 'status_msg_enrolling' %}{% endif %}
                                
                                {% if global_requirements[req_key] %}
                                    <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">{{ global_content.requirements_header_text or 'Requirements' }}</h4>
                                    <ul class="space-y-2 mb-6">
                                        {% for req in global_requirements[req_key] %}
                                        <li class="flex items-start gap-2 text-sm text-gray-700">
                                            <i class="ri-checkbox-circle-fill text-blue-600 mt-0.5"></i>
                                            <span>{{ req.requirement_text }}</span>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                                
                                <!-- Action Buttons -->
                                <div class="flex flex-wrap gap-3">
                                    {% if status == 'Eligible for Enrollment' %}
                                    <form action="{{ url_for('auth.student_initiate_enrollment') }}" method="POST">
                                        <button type="submit" class="bg-blue-600 text-white px-5 py-2.5 rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center gap-2 shadow-sm">
                                            <span>Proceed to Enrollment</span> <i class="ri-arrow-right-line"></i>
                                        </button>
                                    </form>
                                    {% endif %}

                                    {% if status in ['Approved', 'Scheduled'] %}
                                    <button id="viewPermitBtn" class="bg-indigo-600 text-white px-5 py-2.5 rounded-lg font-medium hover:bg-indigo-700 transition-colors shadow-sm flex items-center gap-2">
                                        <i class="ri-ticket-line"></i> View Exam Permit
                                    </button>
                                    {% endif %}

                                    {% if status == 'Passed' %}
                                    <a href="{{ url_for('auth.enrollment_form_page', applicant_id=application.applicant_id) }}" class="bg-green-600 text-white px-5 py-2.5 rounded-lg font-medium hover:bg-green-700 transition-colors shadow-sm flex items-center gap-2">
                                        <i class="ri-file-edit-line"></i> Complete Enrollment Form
                                    </a>
                                    <button id="viewPassedConfirmationBtn" class="bg-white border border-gray-300 text-gray-700 px-5 py-2.5 rounded-lg font-medium hover:bg-gray-50 transition-colors shadow-sm flex items-center gap-2">
                                        <i class="ri-printer-line"></i> Print Result
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Admin Notes -->
                        {% if application.admin_notes %}
                        <div class="bg-yellow-50 rounded-xl p-4 border border-yellow-200 flex gap-3">
                            <i class="ri-sticky-note-fill text-yellow-600 text-xl"></i>
                            <div>
                                <h4 class="font-bold text-yellow-800 text-sm uppercase">Note from Admin</h4>
                                <p class="text-yellow-900 text-sm mt-1 whitespace-pre-wrap">{{ application.admin_notes }}</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Right Column -->
                    <div class="space-y-6">
                        <!-- Contact Card -->
                        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                            <h3 class="text-sm font-bold text-gray-900 uppercase tracking-wide mb-4 pb-2 border-b border-gray-100">
                                {{ global_content.sidebar_contact_title or 'Contact Admissions' }}
                            </h3>
                            <ul class="space-y-4 text-sm">
                                <li class="flex gap-3">
                                    <i class="ri-phone-fill text-blue-600 text-lg"></i>
                                    <div>
                                        <p class="font-semibold text-gray-800">Phone</p>
                                        <a href="tel:{{ global_content.contact_phone }}" class="text-gray-600 hover:text-blue-600">{{ global_content.contact_phone }}</a>
                                    </div>
                                </li>
                                <li class="flex gap-3">
                                    <i class="ri-mail-fill text-blue-600 text-lg"></i>
                                    <div>
                                        <p class="font-semibold text-gray-800">Email</p>
                                        <a href="mailto:{{ global_content.sidebar_email_value }}" class="text-gray-600 hover:text-blue-600 break-all">{{ global_content.sidebar_email_value }}</a>
                                    </div>
                                </li>
                                <li class="flex gap-3">
                                    <i class="ri-time-fill text-blue-600 text-lg"></i>
                                    <div>
                                        <p class="font-semibold text-gray-800">Hours</p>
                                        <p class="text-gray-600">{{ global_content.sidebar_hours_value }}</p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Modals (Permit, Passed) - Same logic, updated classes -->
                <div id="permitStubModal" class="fixed inset-0 bg-black/60 z-[100] hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl flex flex-col max-h-[90vh]">
                         <div class="flex justify-between items-center p-5 border-b border-gray-200">
                            <h3 class="text-lg font-bold text-gray-900">Admission Test Permit</h3>
                            <button id="closePermitStubModalBtn" class="text-gray-500 hover:text-gray-800"><i class="ri-close-line text-2xl"></i></button>
                        </div>
                        <div id="printable-content" class="p-6 overflow-y-auto">
                            <!-- Permit Content (Same as before) -->
                             {% if application %}
                            <div class="border-2 border-dashed border-gray-300 p-6 rounded-lg">
                                <div class="flex justify-between mb-4">
                                    <div>
                                        <p class="text-xs text-gray-500 uppercase">Control Number</p>
                                        <p class="font-mono font-bold text-xl">{{ application.permit_control_no or 'N/A' }}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-xs text-gray-500 uppercase">Exam Date</p>
                                        <p class="font-bold">{{ application.permit_exam_date.strftime('%B %d, %Y') if application.permit_exam_date else 'TBA' }}</p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <p class="text-xs text-gray-500 uppercase">Time</p>
                                        <p class="font-semibold">{{ application.permit_exam_time or 'TBA' }}</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500 uppercase">Room</p>
                                        <p class="font-semibold">{{ application.permit_testing_room or 'TBA' }}</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-4 border-t border-gray-200 pt-4">
                                    <img src="{{ url_for('auth.get_applicant_photo', applicant_id=application.applicant_id) }}" class="w-16 h-16 rounded object-cover border">
                                    <div>
                                        <p class="font-bold text-gray-900 uppercase">{{ application.last_name }}, {{ application.first_name }}</p>
                                        <p class="text-sm text-gray-600">{{ application.program_choice }}</p>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        <div class="p-4 border-t border-gray-200 flex justify-end no-print">
                            <button id="printPermitBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700">Print</button>
                        </div>
                    </div>
                </div>

                <div id="passedConfirmationModal" class="fixed inset-0 bg-black/60 z-[100] hidden flex items-center justify-center p-4">
                     <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg">
                        <div class="flex justify-between items-center p-5 border-b border-gray-200 no-print">
                            <h3 class="text-lg font-bold text-gray-900">Application Result</h3>
                            <button id="closePassedModalBtn" class="text-gray-500 hover:text-gray-800"><i class="ri-close-line text-2xl"></i></button>
                        </div>
                        <div id="printable-content-passed" class="p-8 text-center">
                            <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="ri-trophy-line text-4xl"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-green-700 mb-2">Congratulations!</h2>
                            <p class="text-gray-600">You have passed the admission requirements for <strong>{{ application.program_choice }}</strong>.</p>
                        </div>
                        <div class="p-4 border-t border-gray-200 flex justify-end no-print">
                            <button id="printPassedBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700">Print</button>
                        </div>
                     </div>
                </div>

                {% else %}
                <div class="bg-white rounded-xl shadow-sm p-12 text-center border border-gray-200">
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400">
                        <i class="ri-folder-add-line text-3xl"></i>
                    </div>
                    <h2 class="text-xl font-bold text-gray-900 mb-2">No Application Found</h2>
                    <p class="text-gray-500 mb-6">Start your journey with us today.</p>
                    <a href="{{ url_for('views.new_student') }}" class="bg-blue-600 text-white px-6 py-2.5 rounded-lg font-medium hover:bg-blue-700 transition-colors shadow-sm">
                        Start Application
                    </a>
                </div>
                {% endif %}
                
            </div>
        </main>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        
        function toggleSidebar() {
            sidebar.classList.toggle('-translate-x-full');
            sidebarOverlay.classList.toggle('hidden');
        }

        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', toggleSidebar);
            sidebarOverlay.addEventListener('click', toggleSidebar);
        }

        // Modal & Print Logic (Same as before)
        const openModal = (modal) => {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        };
        const closeModal = (modal) => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        };

        const permitModal = document.getElementById('permitStubModal');
        const passedModal = document.getElementById('passedConfirmationModal');

        document.getElementById('viewPermitBtn')?.addEventListener('click', () => openModal(permitModal));
        document.getElementById('closePermitStubModalBtn')?.addEventListener('click', () => closeModal(permitModal));

        document.getElementById('viewPassedConfirmationBtn')?.addEventListener('click', () => openModal(passedModal));
        document.getElementById('closePassedModalBtn')?.addEventListener('click', () => closeModal(passedModal));

        const printContent = (modalId) => {
            const content = document.getElementById(modalId === 'permitStubModal' ? 'printable-content' : 'printable-content-passed');
            const printWindow = window.open('', '_blank');
            printWindow.document.write('<html><head><title>Print</title><style>body{font-family:sans-serif; padding: 20px;} .border{border:1px solid #ccc;} .p-6{padding:1.5rem;} .text-center{text-align:center;} .font-bold{font-weight:bold;}</style></head><body>');
            printWindow.document.write(content.innerHTML);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            setTimeout(() => { printWindow.focus(); printWindow.print(); printWindow.close(); }, 500);
        };

        document.getElementById('printPermitBtn')?.addEventListener('click', () => printContent('permitStubModal'));
        document.getElementById('printPassedBtn')?.addEventListener('click', () => printContent('passedConfirmationModal'));
    });
</script>
{% endblock %}