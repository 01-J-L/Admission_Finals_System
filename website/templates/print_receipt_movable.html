<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Official Receipt - {{ payment.last_name }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #334155; margin: 0; padding: 40px; display: flex; justify-content: center; }
        
        .receipt-paper {
            width: 4.5in; height: 8.5in; background-color: white;
            position: relative; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        #receipt-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: fill; z-index: 0; }

        .data-field {
            position: absolute; font-family: 'Courier Prime', monospace;
            font-weight: bold; color: #000; z-index: 10;
            line-height: 1; white-space: nowrap;
        }

        .no-print { position: fixed; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 100; }
        .btn { padding: 12px 24px; border-radius: 6px; border: none; font-size: 14px; font-weight: bold; cursor: pointer; text-decoration: none; font-family: sans-serif; }
        .btn-print { background: #4f46e5; color: white; }
        .btn-back { background: #f1f5f9; color: #1e293b; border: 1px solid #cbd5e1; }

        @media print {
            @page { size: 4.5in 8.5in; margin: 0; }
            body { background: white; padding: 0; }
            .no-print { display: none; }
            .receipt-paper { box-shadow: none; margin: 0; width: 4.5in; height: 8.5in; }
            #receipt-bg { display: none !important; }
            .data-field { color: black !important; }
        }
    </style>
</head>
<body>

    <div class="no-print">
        <a href="{{ url_for('auth.update_payment', student_id_db=payment.student_id) }}" class="btn btn-back">‚Üê Back</a>
        <button onclick="window.print()" class="btn btn-print">Print to Form</button>
    </div>

    <div class="receipt-paper">
        <img src="{{ url_for('static', filename='images/uploads/' + bg_file) }}" id="receipt-bg">

        <div class="data-field" style="top: {{ layout.dragDate.top_pos }}; left: {{ layout.dragDate.left_pos }}; font-size: {{ layout.dragDate.font_size }};">
            {{ payment.payment_date.strftime('%Y-%m-%d') }}
        </div>

        <div class="data-field" style="top: {{ layout.dragName.top_pos }}; left: {{ layout.dragName.left_pos }}; font-size: {{ layout.dragName.font_size }};">
            {{ payment.last_name | upper }}, {{ payment.first_name | upper }}
        </div>

        <div class="data-field" style="top: {{ layout.dragDesc.top_pos }}; left: {{ layout.dragDesc.left_pos }}; font-size: {{ layout.dragDesc.font_size }};">
            {{ payment.fee_description }} {{ '(' ~ payment.remark ~ ')' if payment.remark else '' }}
        </div>

        <div class="data-field" style="top: {{ layout.dragAmount.top_pos }}; left: {{ layout.dragAmount.left_pos }}; font-size: {{ layout.dragAmount.font_size }};">
            {{ "{:,.2f}".format(payment.amount_paid) }}
        </div>

        <div class="data-field" style="top: {{ layout.dragTotal.top_pos }}; left: {{ layout.dragTotal.left_pos }}; font-size: {{ layout.dragTotal.font_size }};">
            {{ "{:,.2f}".format(payment.amount_paid) }}
        </div>

        <div class="data-field" style="top: {{ layout.dragWords.top_pos }}; left: {{ layout.dragWords.left_pos }}; font-size: {{ layout.dragWords.font_size }};">
            {{ payment.amount_paid | to_words }}
        </div>

        <div class="data-field" style="top: {{ layout.dragOfficer.top_pos }}; left: {{ layout.dragOfficer.left_pos }}; font-size: {{ layout.dragOfficer.font_size }};">
            {{ payment.cashier_username }}
        </div>
    </div>

</body>
</html>