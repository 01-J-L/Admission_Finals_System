{% extends 'admin_base.html' %}
{% block content %}
<div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md border flex flex-col h-[75vh]">
    <!-- Header -->
    <div class="p-4 border-b flex items-center justify-between bg-gray-50">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-primary text-white rounded-full flex items-center justify-center font-bold">
                {{ student.first_name[0] }}{{ student.last_name[0] }}
            </div>
            <div>
                <h3 class="font-bold text-gray-900">{{ student.first_name }} {{ student.last_name }}</h3>
                <p class="text-[10px] text-green-600 font-bold uppercase">Private Thread: {{ session.user_role }}</p>
            </div>
        </div>
        <a href="{{ url_for('auth.admin_messenger_list') }}" class="text-sm text-gray-500 hover:text-gray-800">Close Chat</a>
    </div>

    <!-- Messages -->
    <div class="flex-1 overflow-y-auto p-6 space-y-4" id="chat-container">
        {% for msg in messages %}
        <div class="flex {{ 'justify-end' if msg.sender_type == 'admin' else 'justify-start' }}">
            <div class="max-w-[70%] p-3 rounded-xl text-sm 
                {{ 'bg-indigo-600 text-white rounded-tr-none' if msg.sender_type == 'admin' else 'bg-gray-100 text-gray-800 rounded-tl-none' }}">
                <p class="text-[9px] font-bold mb-1 opacity-75 uppercase">{{ msg.sender_name }}</p>
                <p>{{ msg.message_text }}</p>
                <span class="text-[9px] block mt-1 opacity-50">{{ msg.created_at.strftime('%H:%M') }}</span>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Form -->
    <form method="POST" class="p-4 border-t flex gap-3">
        <input type="text" name="message" required autocomplete="off" placeholder="Type a reply..." 
               class="flex-1 border-gray-300 rounded-lg text-sm focus:ring-primary focus:border-primary">
        <button type="submit" class="bg-primary text-white px-6 py-2 rounded-lg font-bold text-sm hover:bg-primary/90 transition-colors">
            Send
        </button>
    </form>
</div>

<script>
    const chatContainer = document.getElementById("chat-container");
    chatContainer.scrollTop = chatContainer.scrollHeight;
</script>
{% endblock %}