{% extends "admin_base.html" %}

{% block title %}Manage Academic Term{% endblock %}

{% block page_title %}Manage Academic Term{% endblock %}

{% block breadcrumb %}
<a href="{{ url_for('auth.admin_manage_content') }}" class="text-gray-500 hover:text-primary">Management</a>
<i class="ri-arrow-right-s-line mx-1 text-gray-400"></i>
<span>Manage Academic Term</span>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Enrollment Year Settings -->
    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100 mb-8">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Enrollment Year Settings</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
            <!-- Form to change the year -->
            <form action="{{ url_for('auth.admin_manage_academic_term') }}" method="POST" class="space-y-4">
                <div>
                    <label for="enrollment_year" class="block text-sm font-medium text-gray-700">Current Enrollment Year (for new IDs)</label>
                    <input type="text" name="enrollment_year" id="enrollment_year"
                           class="mt-1 block w-full sm:w-48 border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm"
                           value="{{ settings.current_enrollment_year or '' }}"
                           placeholder="e.g., 2025" required pattern="\d{4}" title="Please enter a 4-digit year.">
                    <p class="text-xs text-gray-500 mt-1">This 4-digit year will be the prefix for newly generated student IDs (e.g., P2025...).</p>
                </div>
                <div>
                    <button type="submit"
                            class="px-4 py-2 bg-primary text-white text-sm font-medium rounded-md shadow-sm hover:bg-primary/90">
                        Save Year
                    </button>
                </div>
            </form>
            <!-- Display last sequence number -->
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                <label class="block text-sm font-medium text-gray-700">Last Used Sequence Number</label>
                <p class="text-2xl font-bold text-gray-900 mt-1">{{ settings.last_sequence_number or '0' }}</p>
                <p class="text-xs text-gray-500 mt-1">This number auto-increments for each new student ID generated and does not reset when the year changes.</p>
            </div>
        </div>
    </div>

    <!-- Add New Academic Term Form -->
    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100 mb-8">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Add New Academic Term</h3>
        <form action="{{ url_for('auth.admin_add_academic_term') }}" method="POST" class="flex flex-wrap items-end gap-4">
            <div>
                <label for="year_name" class="block text-sm font-medium text-gray-700">Academic Year</label>
                <input type="text" name="year_name" id="year_name"
                    class="mt-1 block w-full sm:w-48 border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm"
                    placeholder="e.g., 2025-2026" required>
            </div>
            <div>
                <label for="semester" class="block text-sm font-medium text-gray-700">Semester</label>
                <select name="semester" id="semester" required
                    class="mt-1 block w-full sm:w-48 border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm">
                    <option value="">Select Semester...</option>
                    <option value="1st Semester">1st Semester</option>
                    <option value="2nd Semester">2nd Semester</option>
                    <option value="Summer">Summer</option>
                </select>
            </div>
            <div class="pt-5">
                <button type="submit"
                    class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md shadow-sm hover:bg-blue-700">
                    Save Term
                </button>
                 <a href="{{ url_for('auth.admin_dashboard') }}" class="px-4 py-2 bg-red-500 text-white text-sm font-medium rounded-md shadow-sm hover:bg-red-600">
                    Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- List of Academic Terms -->
    <div class="bg-white shadow-md rounded-lg overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-blue-500 text-white">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Academic Year</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Semester</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Status</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for term in academic_terms %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ term.year_name }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{{ term.semester }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            {% if term.is_active %}
                                <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Open</span>
                            {% else %}
                                <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Close</span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <form action="{{ url_for('auth.admin_toggle_academic_term', term_id=term.id) }}" method="POST" class="inline">
                                {% if term.is_active %}
                                    <input type="hidden" name="action" value="close">
                                    <button type="submit" class="text-gray-600 hover:text-red-700" title="Close this term">Close Term?</button>
                                {% else %}
                                    <input type="hidden" name="action" value="open">
                                    <button type="submit" class="text-blue-600 hover:text-blue-900" title="Set this as the active term">Open Term?</button>
                                {% endif %}
                            </form>
                            <span class="text-gray-300 mx-2">|</span>
                            <form action="{{ url_for('auth.admin_delete_academic_term', term_id=term.id) }}" method="POST" class="inline"
                                  onsubmit="return confirm('Are you sure you want to delete this term? This action cannot be undone and is only possible if no applications are associated with it.');">
                                <button type="submit" class="text-red-500 hover:text-red-700" title="Delete Term">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" class="px-6 py-4 text-center text-gray-500">No academic terms found. Add one to get started.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}