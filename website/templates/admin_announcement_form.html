{% extends 'admin_base.html' %}

{% block title %}
    {% if announcement %}Edit Announcement{% else %}Add Announcement{% endif %}
{% endblock %}

{% block breadcrumb %}
<a href="{{ url_for('auth.admin_manage_content') }}" class="text-gray-500 hover:text-primary">Manage Content</a>
<i class="ri-arrow-right-s-line mx-1 text-gray-400"></i>
<a href="{{ url_for('auth.admin_manage_announcements') }}" class="text-gray-500 hover:text-primary">Announcements</a>
<i class="ri-arrow-right-s-line mx-1 text-gray-400"></i>
<span>{% if announcement %}Edit{% else %}Add{% endif %}</span>
{% endblock %}

{% block page_title %}
    {% if announcement %}Edit Announcement{% else %}Add New Announcement{% endif %}
{% endblock %}

{% block content %}
<div class="bg-white p-6 sm:p-8 rounded-lg shadow-md max-w-3xl mx-auto">
    <form action="{{ url_for('auth.admin_announcement_form', announcement_id=announcement.id if announcement else None) }}" method="POST" enctype="multipart/form-data" class="space-y-6">
        
        <div>
            <label for="title" class="block text-sm font-medium text-gray-700">Title</label>
            <input type="text" name="title" id="title" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm" value="{{ announcement.title if announcement else '' }}" required>
        </div>

        <div>
            <label for="content" class="block text-sm font-medium text-gray-700">Content</label>
            <textarea name="content" id="content" rows="5" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm" required>{{ announcement.content if announcement else '' }}</textarea>
        </div>

        <div>
            <label for="image" class="block text-sm font-medium text-gray-700">Image</label>
            <div class="mt-1 flex items-center space-x-4">
                {% if announcement and announcement.image_filename %}
                    <img id="image-preview" src="{{ url_for('static', filename='images/uploads/' + announcement.image_filename) }}" alt="Current Image" class="w-32 h-20 object-cover rounded-md border">
                {% else %}
                    <img id="image-preview" src="{{ url_for('static', filename='images/default_announcement.jpg') }}" alt="Default Image" class="w-32 h-20 object-cover rounded-md border">
                {% endif %}
                <div class="flex-1">
                    <input type="file" name="image" id="image" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-primary hover:file:bg-indigo-100" accept="image/png, image/jpeg, image/webp">
                    <p class="text-xs text-gray-500 mt-1">
                        {% if announcement and announcement.image_filename %}
                            Uploading a new image will replace the current one.
                        {% else %}
                            Upload a new image. Recommended size: 800x600 pixels.
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>

        <div class="flex items-center">
             <input id="is_active" name="is_active" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded" {% if announcement and announcement.is_active %}checked{% elif not announcement %}checked{% endif %}>
            <label for="is_active" class="ml-2 block text-sm text-gray-900">
                Set as Active
            </label>
            <p class="ml-4 text-xs text-gray-500">If checked, the announcement will be visible on the homepage.</p>
        </div>

        <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200">
            <a href="{{ url_for('auth.admin_manage_announcements') }}" class="px-4 py-2 bg-gray-200 text-gray-800 text-sm font-medium rounded-md shadow-sm hover:bg-gray-300">
                Cancel
            </a>
            <button type="submit" class="inline-flex items-center px-4 py-2 bg-primary text-white text-sm font-medium rounded-md shadow-sm hover:bg-primary/90">
                <i class="ri-save-line mr-2"></i>
                {% if announcement %}Update Announcement{% else %}Create Announcement{% endif %}
            </button>
        </div>
    </form>
</div>

<script>
document.getElementById('image').addEventListener('change', function(event) {
    const [file] = event.target.files;
    if (file) {
        const preview = document.getElementById('image-preview');
        preview.src = URL.createObjectURL(file);
        preview.onload = () => URL.revokeObjectURL(preview.src); // free memory
    }
});
</script>
{% endblock %}